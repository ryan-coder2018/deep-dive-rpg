<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deep Dive RPG - 24 Biomes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; margin: 0; overflow: hidden; font-family: system-ui, -apple-system, sans-serif; color: #f8fafc; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; }
        
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .interactive { pointer-events: auto; }

        .menu-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(2, 6, 23, 0.98); z-index: 50; 
            display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; pointer-events: auto;
        }

        .scroll-area {
            width: 100%; max-width: 420px; max-height: 75vh; overflow-y: auto; 
            padding: 12px; border: 1px solid #1e293b; background: #0f172a; border-radius: 12px;
            scrollbar-width: thin; scrollbar-color: #334155 #0f172a;
        }

        .species-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }

        .fish-card {
            background: #1e293b; border: 1px solid #334155;
            border-radius: 4px; padding: 4px; text-align: center; position: relative;
        }
        .fish-card.found { border-color: #22d3ee; background: rgba(8, 145, 178, 0.2); }
        
        .detail-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; max-width: 300px; background: #1e293b; border: 2px solid #334155;
            border-radius: 20px; padding: 20px; z-index: 100; display: none;
            text-align: center; pointer-events: auto;
        }

        .btn {
            background: #1e293b; color: white; border: 1px solid #334155;
            border-radius: 8px; font-weight: bold; user-select: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .btn:active { background: #334155; transform: scale(0.95); }

        .d-pad {
            position: absolute; bottom: 30px; left: 20px;
            display: grid; grid-template-columns: repeat(3, 50px); grid-template-rows: repeat(3, 50px);
            gap: 6px; pointer-events: none;
        }

        .action-pad {
            position: absolute; bottom: 30px; right: 20px;
            display: flex; flex-direction: column; gap: 10px;
            width: 90px; pointer-events: none;
        }

        .biome-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 14px; margin-bottom: 6px; border-radius: 8px; background: #1e293b;
            border: 1px solid #334155; transition: all 0.2s;
        }
        .biome-item.unlocked { cursor: pointer; border-left-width: 4px; }
        .biome-item.locked { opacity: 0.4; filter: grayscale(1); }

        .catch-anim {
            position: absolute; pointer-events: none; animation: floatUp 0.8s ease-out forwards;
            font-weight: 900; z-index: 1000;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.1); opacity: 0; }
        }
    </style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui-layer">
    <div class="flex justify-between p-4 interactive">
        <div class="bg-slate-900/90 p-2 rounded-lg border border-slate-700 backdrop-blur-sm">
            <div id="ui-biome" class="text-cyan-400 text-[10px] font-bold uppercase tracking-widest">---</div>
            <div id="ui-lvl" class="text-white text-[10px]">RANK: 1</div>
        </div>
        <div class="bg-slate-900/90 p-2 rounded-lg border border-slate-700 text-center min-w-[80px]">
            <div id="ui-coins" class="text-yellow-400 font-bold">$0</div>
            <div class="text-slate-500 text-[8px] uppercase">Balance</div>
        </div>
        <div class="bg-slate-900/90 p-2 rounded-lg border border-slate-700 text-right">
            <div id="ui-log-count" class="text-white text-xs font-bold">0 / 1000</div>
            <div class="text-slate-500 text-[8px] uppercase">Registry</div>
        </div>
    </div>

    <div class="d-pad">
        <div id="ctrl-nw" class="btn text-xs opacity-50 interactive">â†–</div>
        <div id="ctrl-up" class="btn interactive">â–²</div>
        <div id="ctrl-ne" class="btn text-xs opacity-50 interactive">â†—</div>
        <div id="ctrl-left" class="btn interactive">â—€</div>
        <div class="rounded-full border border-slate-800/20"></div>
        <div id="ctrl-right" class="btn interactive">â–¶</div>
        <div id="ctrl-sw" class="btn text-xs opacity-50 interactive">â†™</div>
        <div id="ctrl-down" class="btn interactive">â–¼</div>
        <div id="ctrl-se" class="btn text-xs opacity-50 interactive">â†˜</div>
    </div>

    <div class="action-pad">
        <div id="btn-map" class="btn interactive h-14 border-emerald-500 text-emerald-400">MAP</div>
        <div id="btn-log" class="btn interactive h-14 border-cyan-500 text-cyan-400">LOG</div>
    </div>
</div>

<div id="map-menu" class="menu-overlay">
    <h2 class="text-emerald-400 font-black mb-4 uppercase tracking-widest text-xl">Global Navigation</h2>
    <div id="map-list" class="scroll-area"></div>
    <button class="mt-4 text-slate-500 font-bold px-8 py-2 border border-slate-800 rounded-full" onclick="closeMenus()">CLOSE</button>
</div>

<div id="log-menu" class="menu-overlay">
    <h2 class="text-cyan-400 font-black mb-4 uppercase tracking-widest text-xl">Species Archive</h2>
    <div class="scroll-area">
        <div class="species-grid" id="log-grid"></div>
    </div>
    <button class="mt-4 btn border-cyan-500 text-cyan-400 px-12 h-12" onclick="closeMenus()">EXIT</button>
</div>

<div id="detail-modal" class="detail-modal">
    <div id="det-id" class="text-xs text-slate-500">#0000</div>
    <h3 id="det-name" class="text-xl font-black my-2 tracking-tighter">???</h3>
    <div id="det-box" class="w-24 h-14 mx-auto rounded-lg my-4 shadow-inner border border-white/10"></div>
    <div class="flex justify-around text-sm mb-4">
        <div><div class="text-slate-500 text-[10px] uppercase">Caught</div><div id="det-count" class="font-bold text-lg">0</div></div>
        <div><div class="text-slate-500 text-[10px] uppercase">Record</div><div id="det-pb" class="font-bold text-lg">0.0</div></div>
    </div>
    <button class="mt-2 bg-cyan-600 text-white w-full py-3 rounded-xl font-bold" onclick="document.getElementById('detail-modal').style.display='none'">CLOSE</button>
</div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Expanded 24 Biomes List
    const BIOMES = [
        // Shallow/Tropical (1-6)
        { min: 1, name: 'Sunlit Shallows', bg: '#0ea5e9', particle: '#bae6fd', tierRange: [1, 2] },
        { min: 3, name: 'Coral Gardens', bg: '#0284c7', particle: '#f472b6', tierRange: [2, 3] },
        { min: 7, name: 'Kelp Forest', bg: '#065f46', particle: '#34d399', tierRange: [3, 4] },
        { min: 12, name: 'Mangrove Maze', bg: '#164e63', particle: '#bef264', tierRange: [4, 5] },
        { min: 18, name: 'Sandbar Flats', bg: '#0369a1', particle: '#fef08a', tierRange: [5, 6] },
        { min: 25, name: 'Shipwreck Cove', bg: '#292524', particle: '#a8a29e', tierRange: [6, 7] },
        // Deep/Cold (7-12)
        { min: 35, name: 'Arctic Shelf', bg: '#1e293b', particle: '#ffffff', tierRange: [7, 8] },
        { min: 48, name: 'Twilight Zone', bg: '#1e1b4b', particle: '#818cf8', tierRange: [8, 9] },
        { min: 65, name: 'Basalt Pillars', bg: '#020617', particle: '#4b5563', tierRange: [9, 10] },
        { min: 85, name: 'Midnight Trench', bg: '#000000', particle: '#312e81', tierRange: [10, 11] },
        { min: 110, name: 'Obsidian Chimney', bg: '#0c0a09', particle: '#f87171', tierRange: [11, 12] },
        { min: 140, name: 'Biolume Basin', bg: '#020617', particle: '#22d3ee', tierRange: [12, 13] },
        // Ancient/Mystical (13-18)
        { min: 180, name: 'Glass Reef', bg: '#0f172a', particle: '#f0f9ff', tierRange: [13, 14] },
        { min: 230, name: 'Sunken Atlantis', bg: '#171717', particle: '#fbbf24', tierRange: [14, 15] },
        { min: 290, name: 'Cthulhu\'s Rest', bg: '#052e16', particle: '#10b981', tierRange: [15, 16] },
        { min: 360, name: 'Steam Caverns', bg: '#422006', particle: '#fb923c', tierRange: [16, 17] },
        { min: 450, name: 'Neon Abyss', bg: '#1e1b4b', particle: '#d946ef', tierRange: [17, 18] },
        { min: 550, name: 'Crystal Caves', bg: '#312e81', particle: '#e879f9', tierRange: [18, 19] },
        // Core/Exotic (19-24)
        { min: 700, name: 'Jurassic Core', bg: '#27272a', particle: '#84cc16', tierRange: [19, 20] },
        { min: 900, name: 'Plasma Flow', bg: '#450a0a', particle: '#fb7185', tierRange: [20, 21] },
        { min: 1200, name: 'Void Singularity', bg: '#000000', particle: '#ffffff', tierRange: [21, 22] },
        { min: 1600, name: 'Ether Sea', bg: '#2e1065', particle: '#fbcfe8', tierRange: [22, 23] },
        { min: 2200, name: 'Chrono-Current', bg: '#082f49', particle: '#38bdf8', tierRange: [23, 24] },
        { min: 3000, name: 'The Origin', bg: '#fafafa', particle: '#171717', tierRange: [24, 25] }
    ];

    const FISH_DATA = [];
    const prefixes = ["Neon", "Silver", "Golden", "Ghost", "Dark", "Spotted", "Striped", "Giant", "Mini", "Electric", "Abyssal", "Crystalline", "Volcanic", "Arctic", "Ancient", "Cyber", "Void", "Spectral", "Prismatic", "Majestic"];
    const bodies = ["Tetra", "Guppy", "Molly", "Angelfish", "Catfish", "Shark", "Ray", "Tuna", "Cod", "Eel", "Bass", "Snapper", "Mackerel", "Swordfish", "Salmon", "Trout", "Carp", "Goby", "Blenny", "Puffer"];
    const suffixes = ["Alpha", "Beta", "Prime", "Elder", "Spawn", "Crawler", "Glider", "Predator", "Scavenger", "King", "Queen", "Titan", "Wraith", "Sentinel", "Guard", "Nomad"];

    for(let i=0; i<1000; i++) {
        const tier = Math.min(25, Math.ceil((i + 1) / 40)); 
        const pIdx = (i * 7) % prefixes.length;
        const bIdx = (i * 13) % bodies.length;
        const sIdx = (i * 3) % suffixes.length;
        FISH_DATA.push({
            id: i + 1,
            name: i < 50 ? `${prefixes[pIdx]} ${bodies[bIdx]}` : `${prefixes[pIdx]} ${bodies[bIdx]} ${suffixes[sIdx]}`,
            tier: tier,
            color: `hsl(${(i * 137.5) % 360}, ${40 + tier * 2}%, ${60 - tier}%)`,
            ratio: 1.1 + ((i % 5) * 0.2)
        });
    }

    const state = {
        running: true,
        lvl: 1,
        coins: 0,
        stats: {}, 
        biome: BIOMES[0],
        player: { x: 100, y: 0, r: 16, speed: 6.8 },
        fish: [],
        keys: {}
    };

    function syncUI() {
        document.getElementById('ui-biome').innerText = state.biome.name;
        document.getElementById('ui-lvl').innerText = "RANK: " + state.lvl;
        document.getElementById('ui-coins').innerText = "$" + Math.floor(state.coins).toLocaleString();
        document.getElementById('ui-log-count').innerText = Object.keys(state.stats).length + " / 1000";
    }

    function spawnCatchText(x, y, text, color) {
        const el = document.createElement('div');
        el.className = 'catch-anim';
        el.style.left = x + 'px'; el.style.top = y + 'px';
        el.style.color = color; el.innerText = text;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 800);
    }

    function update() {
        if(!state.running) return;

        let moveX = 0, moveY = 0;
        if(state.keys['up'] || state.keys['nw'] || state.keys['ne']) moveY -= 1;
        if(state.keys['down'] || state.keys['sw'] || state.keys['se']) moveY += 1;
        if(state.keys['left'] || state.keys['nw'] || state.keys['sw']) moveX -= 1;
        if(state.keys['right'] || state.keys['ne'] || state.keys['se']) moveX += 1;

        if (moveX !== 0 || moveY !== 0) {
            const length = Math.hypot(moveX, moveY);
            state.player.x += (moveX / length) * state.player.speed;
            state.player.y += (moveY / length) * state.player.speed;
        }

        state.player.x = Math.max(20, Math.min(canvas.width - 20, state.player.x));
        state.player.y = Math.max(20, Math.min(canvas.height - 20, state.player.y));

        if(Math.random() < 0.07) {
            const tRange = state.biome.tierRange;
            const targetTier = Math.floor(Math.random() * (tRange[1] - tRange[0] + 1)) + tRange[0];
            const pool = FISH_DATA.filter(f => f.tier === targetTier);
            if(pool.length) {
                const pick = pool[Math.floor(Math.random()*pool.length)];
                state.fish.push({
                    x: canvas.width + 120,
                    y: Math.random() * canvas.height,
                    r: 8 + (pick.tier * 1.5),
                    data: pick,
                    weight: (pick.tier * pick.tier * 5) + Math.random() * pick.tier * 10,
                    osc: Math.random() * 10
                });
            }
        }

        for(let i = state.fish.length-1; i >= 0; i--) {
            const f = state.fish[i];
            f.x -= 3.5 + (f.data.tier * 0.25);
            f.y += Math.sin(f.x / 50 + f.osc) * 2.5;
            
            const d = Math.hypot(state.player.x - f.x, state.player.y - f.y);
            if(d < state.player.r + f.r) {
                const sid = f.data.id;
                if(!state.stats[sid]) state.stats[sid] = { count: 0, pb: 0 };
                state.stats[sid].count++;
                if(f.weight > state.stats[sid].pb) state.stats[sid].pb = f.weight;

                const reward = f.weight * 20;
                state.coins += reward;
                // Re-tuned rank curve: takes more to hit level 3000
                state.lvl = 1 + Math.floor(Math.pow(state.coins / 500, 0.7));
                
                spawnCatchText(f.x, f.y, `+${Math.floor(reward)}`, f.data.color);
                state.fish.splice(i, 1);
                syncUI();
            } else if(f.x < -300) state.fish.splice(i, 1);
        }
    }

    function draw() {
        ctx.fillStyle = state.biome.bg;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = state.biome.particle;
        ctx.globalAlpha = 0.2;
        for(let i=0; i<15; i++) {
            ctx.beginPath();
            ctx.arc((Date.now()/40 + i*canvas.width/8)%canvas.width, (i*canvas.height/6)%canvas.height, 2, 0, Math.PI*2);
            ctx.fill();
        }
        ctx.globalAlpha = 1;

        ctx.fillStyle = "#f59e0b";
        ctx.beginPath();
        ctx.ellipse(state.player.x, state.player.y, state.player.r*1.4, state.player.r, 0, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = "#bae6fd";
        ctx.beginPath();
        ctx.arc(state.player.x + 8, state.player.y, 4, 0, Math.PI*2);
        ctx.fill();

        state.fish.forEach(f => {
            ctx.save();
            ctx.translate(f.x, f.y);
            ctx.fillStyle = f.data.color;
            ctx.beginPath();
            ctx.ellipse(0, 0, f.r * f.data.ratio, f.r, 0, 0, Math.PI*2);
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(f.r * 0.8, 0);
            ctx.lineTo(f.r * 1.6, -f.r*0.8);
            ctx.lineTo(f.r * 1.6, f.r*0.8);
            ctx.fill();
            ctx.fillStyle = "white";
            ctx.beginPath(); ctx.arc(-f.r * 0.7, -f.r * 0.2, 2, 0, Math.PI*2); ctx.fill();
            ctx.restore();
        });
    }

    function closeMenus() {
        document.getElementById('map-menu').style.display = 'none';
        document.getElementById('log-menu').style.display = 'none';
        state.running = true;
    }

    document.getElementById('btn-map').onclick = () => {
        state.running = false;
        const list = document.getElementById('map-list');
        list.innerHTML = '';
        BIOMES.forEach(b => {
            const locked = state.lvl < b.min;
            const item = document.createElement('div');
            item.className = `biome-item ${locked ? 'locked' : 'unlocked'}`;
            if(!locked) item.style.borderLeftColor = b.particle;
            item.innerHTML = `
                <div class="flex-1">
                    <div class="text-xs font-black text-white uppercase">${b.name}</div>
                    <div class="text-[8px] text-slate-400">${locked ? 'RANK '+b.min+' REQ' : 'ACTIVE'}</div>
                </div>
                <div class="text-[10px] font-black">${locked ? 'ðŸ”’' : 'âž¤'}</div>
            `;
            if(!locked) {
                item.onclick = () => {
                    state.biome = b;
                    state.fish = [];
                    closeMenus();
                    syncUI();
                };
            }
            list.appendChild(item);
        });
        document.getElementById('map-menu').style.display = 'flex';
    };

    document.getElementById('btn-log').onclick = () => {
        state.running = false;
        const grid = document.getElementById('log-grid');
        grid.innerHTML = '';
        const frag = document.createDocumentFragment();
        FISH_DATA.forEach(f => {
            const s = state.stats[f.id];
            const card = document.createElement('div');
            card.className = `fish-card ${s ? 'found' : ''}`;
            card.innerHTML = `
                <div class="w-full h-2 my-1" style="background:${s ? f.color : '#1e293b'}"></div>
                <div class="text-[6px] font-bold text-slate-500 truncate">${f.id}</div>
            `;
            card.onclick = () => {
                document.getElementById('det-id').innerText = "#" + String(f.id).padStart(4, '0');
                document.getElementById('det-name').innerText = s ? f.name : "???";
                document.getElementById('det-box').style.backgroundColor = s ? f.color : "#1e293b";
                document.getElementById('det-count').innerText = s ? s.count : "0";
                document.getElementById('det-pb').innerText = s ? s.pb.toFixed(1) + "kg" : "0.0kg";
                document.getElementById('detail-modal').style.display = 'block';
            };
            frag.appendChild(card);
        });
        grid.appendChild(frag);
        document.getElementById('log-menu').style.display = 'flex';
    };

    function setupKeys() {
        const controls = ['ctrl-up','ctrl-down','ctrl-left','ctrl-right','ctrl-nw','ctrl-ne','ctrl-sw','ctrl-se'];
        controls.forEach(id => {
            const key = id.split('-')[1];
            const el = document.getElementById(id);
            const start = (e) => { e.preventDefault(); state.keys[key] = true; };
            const end = (e) => { e.preventDefault(); state.keys[key] = false; };
            el.addEventListener('mousedown', start);
            el.addEventListener('touchstart', start, {passive: false});
            el.addEventListener('mouseup', end);
            el.addEventListener('touchend', end, {passive: false});
            el.addEventListener('mouseleave', end);
        });
    }

    window.onresize = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    };

    window.onload = () => {
        window.onresize();
        state.player.y = canvas.height / 2;
        setupKeys();
        syncUI();
        (function loop() {
            update(); draw(); requestAnimationFrame(loop);
        })();
    };
</script>
</body>
</html>
